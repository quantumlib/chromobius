# Copyright 2023 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import itertools
from typing import Any

import pytest
import stim

import gen
from clorco.color_code._bell_flagged_planar_color_code_circuits import (
    make_bell_flagged_color_code_circuit,
    make_bell_flagged_color_code_circuit_round_chunks,
)
from clorco._make_circuit import make_circuit


@pytest.mark.parametrize(
    "d,b,i",
    itertools.product(
        [3, 5, 7],
        ["X", "Z"],
        [False, True],
    ),
)
def test_make_bell_flagged_color_code_circuit_round_chunk(d: int, b: Any, i: bool):
    chunks = make_bell_flagged_color_code_circuit_round_chunks(
        base_data_width=d,
        initialize=i,
        basis=b,
    )
    for chunk in chunks:
        chunk.verify()
    if d == 5:
        if i:
            assert len(chunks[0].flows) == 3 * 9 + 1
            assert len(chunks[1].flows) == (4 * 9 + 1 if b == "X" else 3 * 9 + 1)
        else:
            assert len(chunks[0].flows) == 4 * 9 + 1
            assert len(chunks[1].flows) == 4 * 9 + 1


@pytest.mark.parametrize(
    "d,b,r",
    itertools.product(
        [3, 5],
        ["X", "Z"],
        [2, 3, 5],
    ),
)
def test_make_bell_flagged_color_code_circuit(d: int, b: Any, r: int):
    circuit = make_bell_flagged_color_code_circuit(
        base_data_width=d,
        basis=b,
        rounds=r,
    )
    assert (
        circuit.count_determined_measurements()
        == circuit.num_detectors + circuit.num_observables
    )
    circuit = gen.NoiseModel.uniform_depolarizing(1e-3).noisy_circuit(circuit)
    assert (
        len(
            circuit.search_for_undetectable_logical_errors(
                dont_explore_detection_event_sets_with_size_above=4,
                dont_explore_edges_with_degree_above=3,
                dont_explore_edges_increasing_symptom_degree=False,
            )
        )
        == d
    )


def test_make_bell_flagged_color_code_circuit_exact():
    p = 0.001
    circuit = make_circuit(
        style="bell_flagged_color_code_X",
        noise_model=gen.NoiseModel.si1000(p),
        noise_strength=p,
        rounds=100,
        diameter=5,
        convert_to_cz=True,
        editable_extras={},
    )
    assert circuit == stim.Circuit(
        """QUBIT_COORDS(0, 0) 0
QUBIT_COORDS(1, 0) 1
QUBIT_COORDS(1, 1) 2
QUBIT_COORDS(1, 2) 3
QUBIT_COORDS(2, 0) 4
QUBIT_COORDS(2, 1) 5
QUBIT_COORDS(2, 2) 6
QUBIT_COORDS(2, 3) 7
QUBIT_COORDS(3, 0) 8
QUBIT_COORDS(3, 1) 9
QUBIT_COORDS(3, 2) 10
QUBIT_COORDS(3, 3) 11
QUBIT_COORDS(3, 4) 12
QUBIT_COORDS(3, 5) 13
QUBIT_COORDS(4, 0) 14
QUBIT_COORDS(4, 1) 15
QUBIT_COORDS(4, 2) 16
QUBIT_COORDS(4, 3) 17
QUBIT_COORDS(4, 4) 18
QUBIT_COORDS(4, 5) 19
QUBIT_COORDS(4, 6) 20
QUBIT_COORDS(5, 0) 21
QUBIT_COORDS(5, 1) 22
QUBIT_COORDS(5, 2) 23
QUBIT_COORDS(5, 3) 24
QUBIT_COORDS(5, 4) 25
QUBIT_COORDS(5, 5) 26
QUBIT_COORDS(6, 0) 27
QUBIT_COORDS(6, 1) 28
QUBIT_COORDS(6, 2) 29
QUBIT_COORDS(6, 3) 30
QUBIT_COORDS(6, 4) 31
QUBIT_COORDS(7, 0) 32
QUBIT_COORDS(7, 1) 33
QUBIT_COORDS(7, 2) 34
QUBIT_COORDS(8, 0) 35
QUBIT_COORDS(8, 1) 36
R 1 3 9 11 13 21 23 25 33 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35 4 6 15 17 19 27 29 31 36
X_ERROR(0.002) 1 3 9 11 13 21 23 25 33 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35 4 6 15 17 19 27 29 31 36
TICK
H 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36
DEPOLARIZE1(0.0001) 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 9 11 13 21 23 25 33
DEPOLARIZE1(0.0001) 1 3 9 11 13 21 23 25 33 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36
TICK
CZ 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE2(0.001) 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE1(0.0001) 0 3 8 13 14 31 32 35 36
TICK
CZ 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE2(0.001) 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE1(0.0001) 2 3 12 13 20 30 31 35 36
TICK
CZ 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE2(0.001) 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE1(0.0001) 0 1 4 7 20 21 26 27 34
TICK
H 1 2 3 5 8 9 10 11 12 13 14 16 18 21 22 23 24 25 28 30 32 33 35
DEPOLARIZE1(0.0001) 1 2 3 5 8 9 10 11 12 13 14 16 18 21 22 23 24 25 28 30 32 33 35 0 4 6 7 15 17 19 20 26 27 29 31 34 36
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
M(0.005) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
DETECTOR(1, 0, 0, 9) rec[-18]
DETECTOR(1, 2, 0, 11) rec[-17]
DETECTOR(3, 1, 0, 10) rec[-16]
DETECTOR(3, 3, 0, 9) rec[-15]
DETECTOR(3, 5, 0, 11) rec[-14]
DETECTOR(5, 0, 0, 9) rec[-13]
DETECTOR(5, 2, 0, 11) rec[-12]
DETECTOR(5, 4, 0, 10) rec[-11]
DETECTOR(7, 1, 0, 10) rec[-10]
SHIFT_COORDS(0, 0, 1)
DEPOLARIZE1(0.001) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
R 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
X_ERROR(0.002) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 0 4 6 7 15 17 19 20 26 27 29 31 34 36
DEPOLARIZE1(0.0001) 0 4 6 7 15 17 19 20 26 27 29 31 34 36 1 2 3 5 8 9 10 11 12 13 14 16 18 21 22 23 24 25 28 30 32 33 35
TICK
CZ 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE2(0.001) 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE1(0.0001) 0 3 8 13 14 31 32 35 36
TICK
CZ 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE2(0.001) 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE1(0.0001) 2 3 12 13 20 30 31 35 36
TICK
CZ 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE2(0.001) 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE1(0.0001) 0 1 4 7 20 21 26 27 34
TICK
H 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36
DEPOLARIZE1(0.0001) 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36 1 3 9 11 13 21 23 25 33
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
M(0.005) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
DETECTOR(1, 0, 0, 0) rec[-18]
DETECTOR(1, 2, 0, 2) rec[-17]
DETECTOR(2, 0, 0, 6) rec[-9]
DETECTOR(2, 2, 0, 8) rec[-8]
DETECTOR(3, 1, 0, 1) rec[-16]
DETECTOR(3, 3, 0, 0) rec[-15]
DETECTOR(3, 5, 0, 2) rec[-14]
DETECTOR(4, 1, 0, 7) rec[-7]
DETECTOR(4, 3, 0, 6) rec[-6]
DETECTOR(4, 5, 0, 8) rec[-5]
DETECTOR(5, 0, 0, 0) rec[-13]
DETECTOR(5, 2, 0, 2) rec[-12]
DETECTOR(5, 4, 0, 1) rec[-11]
DETECTOR(6, 0, 0, 6) rec[-4]
DETECTOR(6, 2, 0, 8) rec[-3]
DETECTOR(6, 4, 0, 7) rec[-2]
DETECTOR(7, 1, 0, 1) rec[-10]
DETECTOR(8, 1, 0, 7) rec[-1]
SHIFT_COORDS(0, 0, 1)
DEPOLARIZE1(0.001) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
REPEAT 98 {
    R 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    X_ERROR(0.002) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
    DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    H 1 3 9 11 13 21 23 25 33
    DEPOLARIZE1(0.0001) 1 3 9 11 13 21 23 25 33 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36
    TICK
    CZ 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
    DEPOLARIZE2(0.001) 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
    DEPOLARIZE1(0.0001) 0 3 8 13 14 31 32 35 36
    TICK
    CZ 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
    DEPOLARIZE2(0.001) 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
    DEPOLARIZE1(0.0001) 2 3 12 13 20 30 31 35 36
    TICK
    CZ 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
    DEPOLARIZE2(0.001) 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
    DEPOLARIZE1(0.0001) 0 1 4 7 20 21 26 27 34
    TICK
    H 1 2 3 5 8 9 10 11 12 13 14 16 18 21 22 23 24 25 28 30 32 33 35
    DEPOLARIZE1(0.0001) 1 2 3 5 8 9 10 11 12 13 14 16 18 21 22 23 24 25 28 30 32 33 35 0 4 6 7 15 17 19 20 26 27 29 31 34 36
    TICK
    CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
    DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    M(0.005) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    DETECTOR(1, 0, 0, 9) rec[-18]
    DETECTOR(1, 2, 0, 11) rec[-17]
    DETECTOR(2, 0, 0, 3) rec[-45] rec[-9]
    DETECTOR(2, 2, 0, 5) rec[-44] rec[-8]
    DETECTOR(3, 1, 0, 10) rec[-16]
    DETECTOR(3, 3, 0, 9) rec[-15]
    DETECTOR(3, 5, 0, 11) rec[-14]
    DETECTOR(4, 1, 0, 4) rec[-43] rec[-7]
    DETECTOR(4, 3, 0, 3) rec[-42] rec[-6]
    DETECTOR(4, 5, 0, 5) rec[-41] rec[-5]
    DETECTOR(5, 0, 0, 9) rec[-13]
    DETECTOR(5, 2, 0, 11) rec[-12]
    DETECTOR(5, 4, 0, 10) rec[-11]
    DETECTOR(6, 0, 0, 3) rec[-40] rec[-4]
    DETECTOR(6, 2, 0, 5) rec[-39] rec[-3]
    DETECTOR(6, 4, 0, 4) rec[-38] rec[-2]
    DETECTOR(7, 1, 0, 10) rec[-10]
    DETECTOR(8, 1, 0, 4) rec[-37] rec[-1]
    SHIFT_COORDS(0, 0, 1)
    DEPOLARIZE1(0.001) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    R 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    X_ERROR(0.002) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
    DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    H 0 4 6 7 15 17 19 20 26 27 29 31 34 36
    DEPOLARIZE1(0.0001) 0 4 6 7 15 17 19 20 26 27 29 31 34 36 1 2 3 5 8 9 10 11 12 13 14 16 18 21 22 23 24 25 28 30 32 33 35
    TICK
    CZ 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
    DEPOLARIZE2(0.001) 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
    DEPOLARIZE1(0.0001) 0 3 8 13 14 31 32 35 36
    TICK
    CZ 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
    DEPOLARIZE2(0.001) 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
    DEPOLARIZE1(0.0001) 2 3 12 13 20 30 31 35 36
    TICK
    CZ 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
    DEPOLARIZE2(0.001) 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
    DEPOLARIZE1(0.0001) 0 1 4 7 20 21 26 27 34
    TICK
    H 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36
    DEPOLARIZE1(0.0001) 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36 1 3 9 11 13 21 23 25 33
    TICK
    CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
    DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
    M(0.005) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    DETECTOR(1, 0, 0, 0) rec[-54] rec[-18]
    DETECTOR(1, 2, 0, 2) rec[-53] rec[-17]
    DETECTOR(2, 0, 0, 6) rec[-9]
    DETECTOR(2, 2, 0, 8) rec[-8]
    DETECTOR(3, 1, 0, 1) rec[-52] rec[-16]
    DETECTOR(3, 3, 0, 0) rec[-51] rec[-15]
    DETECTOR(3, 5, 0, 2) rec[-50] rec[-14]
    DETECTOR(4, 1, 0, 7) rec[-7]
    DETECTOR(4, 3, 0, 6) rec[-6]
    DETECTOR(4, 5, 0, 8) rec[-5]
    DETECTOR(5, 0, 0, 0) rec[-49] rec[-13]
    DETECTOR(5, 2, 0, 2) rec[-48] rec[-12]
    DETECTOR(5, 4, 0, 1) rec[-47] rec[-11]
    DETECTOR(6, 0, 0, 6) rec[-4]
    DETECTOR(6, 2, 0, 8) rec[-3]
    DETECTOR(6, 4, 0, 7) rec[-2]
    DETECTOR(7, 1, 0, 1) rec[-46] rec[-10]
    DETECTOR(8, 1, 0, 7) rec[-1]
    SHIFT_COORDS(0, 0, 1)
    DEPOLARIZE1(0.001) 1 3 9 11 13 21 23 25 33 4 6 15 17 19 27 29 31 36
    DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
    TICK
}
R 36 31 29 27 19 17 15 6 4 33 25 23 21 13 11 9 3 1
X_ERROR(0.002) 36 31 29 27 19 17 15 6 4 33 25 23 21 13 11 9 3 1
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36
DEPOLARIZE1(0.0001) 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36 1 3 9 11 13 21 23 25 33
TICK
CZ 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE2(0.001) 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE1(0.0001) 0 1 4 7 20 21 26 27 34
TICK
CZ 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE2(0.001) 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE1(0.0001) 2 3 12 13 20 30 31 35 36
TICK
CZ 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE2(0.001) 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE1(0.0001) 0 3 8 13 14 31 32 35 36
TICK
H 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36
DEPOLARIZE1(0.0001) 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36 1 3 9 11 13 21 23 25 33
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
M(0.005) 36 31 29 27 19 17 15 6 4 33 25 23 21 13 11 9 3 1
DETECTOR(1, 0, 0, 0) rec[-36] rec[-1]
DETECTOR(1, 2, 0, 2) rec[-35] rec[-2]
DETECTOR(2, 0, 0, 6) rec[-10]
DETECTOR(2, 2, 0, 8) rec[-11]
DETECTOR(3, 1, 0, 1) rec[-34] rec[-3]
DETECTOR(3, 3, 0, 0) rec[-33] rec[-4]
DETECTOR(3, 5, 0, 2) rec[-32] rec[-5]
DETECTOR(4, 1, 0, 7) rec[-12]
DETECTOR(4, 3, 0, 6) rec[-13]
DETECTOR(4, 5, 0, 8) rec[-14]
DETECTOR(5, 0, 0, 0) rec[-31] rec[-6]
DETECTOR(5, 2, 0, 2) rec[-30] rec[-7]
DETECTOR(5, 4, 0, 1) rec[-29] rec[-8]
DETECTOR(6, 0, 0, 6) rec[-15]
DETECTOR(6, 2, 0, 8) rec[-16]
DETECTOR(6, 4, 0, 7) rec[-17]
DETECTOR(7, 1, 0, 1) rec[-28] rec[-9]
DETECTOR(8, 1, 0, 7) rec[-18]
SHIFT_COORDS(0, 0, 1)
DEPOLARIZE1(0.001) 36 31 29 27 19 17 15 6 4 33 25 23 21 13 11 9 3 1
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
R 36 31 29 27 19 17 15 6 4 33 25 23 21 13 11 9 3 1
X_ERROR(0.002) 36 31 29 27 19 17 15 6 4 33 25 23 21 13 11 9 3 1
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
DEPOLARIZE1(0.002) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36
DEPOLARIZE1(0.0001) 1 3 4 6 9 11 13 15 17 19 21 23 25 27 29 31 33 36 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 1 3 9 11 13 21 23 25 33
DEPOLARIZE1(0.0001) 1 3 9 11 13 21 23 25 33 0 2 4 5 6 7 8 10 12 14 15 16 17 18 19 20 22 24 26 27 28 29 30 31 32 34 35 36
TICK
CZ 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE2(0.001) 2 3 5 6 8 9 10 11 12 13 14 15 16 17 18 19 22 23 24 25 28 29 30 31 32 33 35 36
DEPOLARIZE1(0.0001) 0 1 4 7 20 21 26 27 34
TICK
CZ 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE2(0.001) 0 1 4 8 5 9 6 10 7 11 14 21 15 22 16 23 17 24 18 25 19 26 27 32 28 33 29 34
DEPOLARIZE1(0.0001) 2 3 12 13 20 30 31 35 36
TICK
CZ 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE2(0.001) 1 2 4 5 6 7 9 10 11 12 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 33 34
DEPOLARIZE1(0.0001) 0 3 8 13 14 31 32 35 36
TICK
H 1 2 3 5 7 9 10 11 12 13 16 18 20 21 22 23 24 25 26 28 30 33 34
DEPOLARIZE1(0.0001) 1 2 3 5 7 9 10 11 12 13 16 18 20 21 22 23 24 25 26 28 30 33 34 0 4 6 8 14 15 17 19 27 29 31 32 35 36
TICK
CZ 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE2(0.001) 1 4 3 6 9 15 11 17 13 19 21 27 23 29 25 31 33 36
DEPOLARIZE1(0.0001) 0 2 5 7 8 10 12 14 16 18 20 22 24 26 28 30 32 34 35
TICK
H 0 1 3 4 6 8 9 11 13 14 15 17 19 21 23 25 27 29 31 32 33 35 36
DEPOLARIZE1(0.0001) 0 1 3 4 6 8 9 11 13 14 15 17 19 21 23 25 27 29 31 32 33 35 36 2 5 7 10 12 16 18 20 22 24 26 28 30 34
TICK
M(0.005) 36 31 29 27 19 17 15 6 4 35 34 32 30 28 26 24 22 20 18 16 14 12 10 8 7 5 2 0 33 25 23 21 13 11 9 3 1
DETECTOR(1, 0, 0, 9) rec[-1]
DETECTOR(1, 0, 1, 0) rec[-38] rec[-14] rec[-12] rec[-11] rec[-10] rec[-2]
DETECTOR(1, 2, 0, 11) rec[-2]
DETECTOR(1, 2, 1, 2) rec[-39] rec[-15] rec[-13] rec[-12] rec[-11] rec[-2] rec[-1]
DETECTOR(2, 0, 0, 3) rec[-82] rec[-48] rec[-29]
DETECTOR(2, 2, 0, 5) rec[-81] rec[-48] rec[-47] rec[-30]
DETECTOR(3, 1, 0, 10) rec[-3]
DETECTOR(3, 1, 1, 1) rec[-40] rec[-21] rec[-18] rec[-17] rec[-15] rec[-14] rec[-12] rec[-4] rec[-3]
DETECTOR(3, 3, 0, 9) rec[-4]
DETECTOR(3, 3, 1, 0) rec[-41] rec[-22] rec[-19] rec[-18] rec[-16] rec[-15] rec[-13] rec[-5] rec[-4] rec[-3]
DETECTOR(3, 5, 0, 11) rec[-5]
DETECTOR(3, 5, 1, 2) rec[-42] rec[-23] rec[-20] rec[-19] rec[-16] rec[-5] rec[-4]
DETECTOR(4, 1, 0, 4) rec[-80] rec[-50] rec[-49] rec[-31]
DETECTOR(4, 3, 0, 3) rec[-79] rec[-51] rec[-50] rec[-49] rec[-32]
DETECTOR(4, 5, 0, 5) rec[-78] rec[-51] rec[-50] rec[-33]
DETECTOR(5, 0, 0, 9) rec[-6]
DETECTOR(5, 0, 1, 0) rec[-43] rec[-26] rec[-24] rec[-21] rec[-17] rec[-7]
DETECTOR(5, 2, 0, 11) rec[-7]
DETECTOR(5, 2, 1, 2) rec[-44] rec[-27] rec[-25] rec[-24] rec[-22] rec[-21] rec[-18] rec[-8] rec[-7] rec[-6]
DETECTOR(5, 4, 0, 10) rec[-8]
DETECTOR(5, 4, 1, 1) rec[-45] rec[-25] rec[-23] rec[-22] rec[-19] rec[-8] rec[-7]
DETECTOR(6, 0, 0, 3) rec[-77] rec[-53] rec[-34]
DETECTOR(6, 2, 0, 5) rec[-76] rec[-54] rec[-53] rec[-52] rec[-35]
DETECTOR(6, 4, 0, 4) rec[-75] rec[-54] rec[-53] rec[-36]
DETECTOR(7, 1, 0, 10) rec[-9]
DETECTOR(7, 1, 1, 1) rec[-46] rec[-28] rec[-27] rec[-26] rec[-24] rec[-9]
DETECTOR(8, 1, 0, 4) rec[-74] rec[-55] rec[-37]
OBSERVABLE_INCLUDE(0) rec[-28] rec[-27] rec[-26] rec[-25] rec[-24] rec[-23] rec[-22] rec[-21] rec[-20] rec[-19] rec[-18] rec[-17] rec[-16] rec[-15] rec[-14] rec[-13] rec[-12] rec[-11] rec[-10] rec[-9] rec[-8] rec[-7] rec[-5] rec[-4] rec[-3] rec[-2]
SHIFT_COORDS(0, 0, 2)
DEPOLARIZE1(0.001) 36 31 29 27 19 17 15 6 4 35 34 32 30 28 26 24 22 20 18 16 14 12 10 8 7 5 2 0 33 25 23 21 13 11 9 3 1"""
    )
